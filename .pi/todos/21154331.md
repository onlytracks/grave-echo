{
  "id": "21154331",
  "title": "Phase 0a.2: Renderer Interface + ANSI Implementation",
  "tags": [
    "phase-0a",
    "renderer",
    "foundation"
  ],
  "status": "done",
  "created_at": "2026-02-14T22:58:27.268Z"
}

## Goal
Build the renderer abstraction and initial ANSI terminal implementation in `src/renderer/`.

## Read First
- `AGENTS.md` — project constraints (renderer abstraction is non-negotiable)
- `docs/technical.md` — Renderer interface, screen components, layout

## Dependencies
- Requires: Phase 0a.1 (ECS Core) completed

## Requirements

### `src/renderer/renderer.ts` — Renderer Interface
```typescript
interface Renderer {
  init(): void;
  shutdown(): void;
  clear(): void;
  drawCell(x: number, y: number, char: string, fg: Color, bg: Color): void;
  drawText(x: number, y: number, text: string, fg: Color): void;
  drawBox(x: number, y: number, width: number, height: number, title?: string): void;
  flush(): void;
  getScreenSize(): { width: number; height: number };
}
```
Define a `Color` type — can be string (ANSI color names or hex) or an enum. Keep it simple.

### `src/renderer/ansi.ts` — ANSI Terminal Implementation
Implements the `Renderer` interface using raw ANSI escape codes to stdout.
- `init()`: enter alternate screen buffer, hide cursor, enable raw mode
- `shutdown()`: restore cursor, exit alternate screen, disable raw mode
- `clear()`: clear the alternate screen buffer
- `drawCell()`: move cursor to position, set colors, write character
- `drawText()`: draw a string starting at position
- `drawBox()`: draw a box using Unicode box-drawing characters (┌─┐│└─┘)
- `flush()`: use a write buffer — collect all draws, write to stdout once per frame
- Use `process.stdout.write()` for output
- Handle basic ANSI: cursor movement (`\x1b[row;colH`), colors (`\x1b[38;5;Nm` for fg,
  `\x1b[48;5;Nm` for bg), reset (`\x1b[0m`)

### `src/renderer/panels/game-grid.ts` — Game Grid Panel
- Renders a 2D grid of cells within a bounded screen region
- Takes the ECS world and a camera/viewport position
- Draws all entities with Position + Renderable components at their grid positions
- Draws terrain/walls from the map data
- Surrounded by a box border with optional title

### For Phase 0a, skip these panels (build later):
- PlayerStats, TargetInfo, MessageLog, EquipmentPanel
- Layout manager — just hardcode the game grid position for now

## Design Constraints
- Game code NEVER writes ANSI escape codes directly — always through the Renderer interface
- The panel receives a bounded region (x, y, width, height) and renders within it
- Use Bun/Node `process.stdout` — no external terminal libraries

## Tests
Renderer is hard to unit test (terminal output). Instead:
- Test that AnsiRenderer implements Renderer interface (type checking)
- Test buffer logic if separated: draw commands produce expected escape sequences
- Manual verification: run and visually confirm grid renders

## Definition of Done
- Renderer interface defined with all methods
- AnsiRenderer implements it with working ANSI output
- GameGrid panel renders a 2D grid of entities within a bordered region
- Running the game shows a bordered grid in the terminal
- `shutdown()` cleanly restores the terminal state (no garbled terminal on exit)
