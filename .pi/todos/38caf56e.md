{
  "id": "38caf56e",
  "title": "Phase 1.1: Debug Panel",
  "tags": [
    "phase-1",
    "renderer",
    "debug"
  ],
  "status": "done",
  "created_at": "2026-02-15T01:27:45.292Z"
}

## Goal
Add a debug UI panel that displays ECS internals alongside the game grid during development.
Toggleable with a keypress so it doesn't interfere with normal play.

## Read First
- `AGENTS.md` — project constraints (renderer abstraction)
- `docs/technical.md` — screen layout, renderer interface, panel architecture

## Existing Code Context
- Renderer interface: `src/renderer/renderer.ts` — `Renderer` interface with drawCell,
  drawText, drawBox, flush, getScreenSize
- ANSI implementation: `src/renderer/ansi.ts` — `AnsiRenderer` class
- Game grid panel: `src/renderer/panels/game-grid.ts` — renders map + entities in a bounded region
- Game loop: `src/game.ts` — `Game` class with render() method, currently draws game grid +
  status line + 3-line message log below the grid
- Input handler: `src/input/input-handler.ts` — parses keypresses into `InputEvent` types
- Components: `src/ecs/components.ts` — Position, Renderable, Health, Stats, TurnActor,
  AIControlled, Faction, PlayerControlled, Collidable
- ECS World: `src/ecs/world.ts` — World class with query(), getComponent(), hasComponent()

## Requirements

### `src/renderer/panels/debug-panel.ts` — Debug Panel
An independent panel (like game-grid.ts) that renders ECS debug info within a bounded region.

Display the following:
- **Entity count** — total entities in the world
- **Player entity details:**
  - Position (x, y)
  - Health (current/max)
  - Stats (str, def, spd)
  - TurnActor (hasActed, movementRemaining)
- **All AI entities** (list each with):
  - Entity ID
  - Position (x, y)
  - Health (current/max)
  - AI pattern + target entity ID
  - Distance to target (manhattan distance)
- **Turn state** — whose turn it is (player or AI)

Function signature should follow the same pattern as game-grid.ts:
```typescript
export function renderDebugPanel(
  renderer: Renderer,
  world: World,
  region: { x: number; y: number; width: number; height: number },
): void
```

The panel should draw a box border with title "Debug" and render all info within.

### Toggle Key
- Add `F1` key to the input handler as a new InputEvent: `{ type: 'toggleDebug' }`
- F1 escape sequence: `\x1b[11~` or `\x1bOP` (handle both variants)
- Toggle is **free** — not a primary or secondary action, doesn't affect turns

### Update Game.render()
In `src/game.ts`:
- Add a `debugVisible: boolean` field to the Game class, default `false`
- When `debugVisible` is true, render the screen in a split layout:
  - Game grid on the left (reduced width)
  - Debug panel on the right (fill remaining width)
- When `debugVisible` is false, render as currently (full width game grid)
- Handle the `toggleDebug` input event in the game loop — flip `debugVisible`, re-render

### Layout When Debug is Visible
```
┌──────────────────┬──────────────────┐
│                  │ Debug            │
│   Game Grid      │ Entities: 3      │
│                  │                  │
│                  │ Player (id: 1)   │
│                  │  pos: 10, 7      │
│                  │  hp: 20/20       │
│                  │  str:5 def:2 spd:3│
│                  │  moved: 1/3      │
│                  │                  │
│                  │ Enemy (id: 2)    │
│                  │  pos: 3, 3       │
│                  │  hp: 8/8         │
│                  │  ai: charger → 1 │
│                  │  dist: 11        │
├──────────────────┴──────────────────┤
│ HP: 20/20 | Moves: 2/3 | ...       │
│ combat messages...                  │
└─────────────────────────────────────┘
```

Split the available width roughly 60/40 between game grid and debug panel.

## Design Constraints
- Debug panel is a **development tool** — don't over-engineer it, but make it useful
- Uses the same Renderer interface — no direct ANSI
- Panel knows nothing about screen position — it receives a region and renders within it
- Toggle doesn't consume a turn action — it's purely a UI toggle
- The debug panel must update every render cycle (shows live data)

## Tests
No automated tests needed — this is a visual debug tool. Verify manually:
- F1 toggles the debug panel on/off
- Panel shows correct entity data (matches actual game state)
- Panel updates live as the player moves and combat occurs
- Entities that die disappear from the debug panel
- Layout doesn't break with debug panel visible

## Definition of Done
- `src/renderer/panels/debug-panel.ts` exists and renders entity debug info
- F1 toggles the debug panel on and off
- Debug panel shows player stats, all AI entities with their state, entity count
- Game grid resizes to accommodate the debug panel when visible
- No gameplay impact — toggle is free, doesn't affect turns
