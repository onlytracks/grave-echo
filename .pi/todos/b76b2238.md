{
  "id": "b76b2238",
  "title": "Phase 0b.1: Health + Stats Components, Turn System",
  "tags": [
    "phase-0b",
    "ecs",
    "combat"
  ],
  "status": "pending",
  "created_at": "2026-02-14T22:59:48.664Z"
}

## Goal
Add Health and Stats components, add a TurnSystem that manages player-then-enemies turn
order, and introduce movement points (speed stat).

## Read First
- `AGENTS.md` — universal entity system constraint
- `docs/combat.md` — full turn structure, entity action economy, speed/movement
- `docs/technical.md` — TurnSystem description

## Dependencies
- Requires: Phase 0a complete (playable player movement)

## Requirements

### New Components in `src/ecs/components.ts`
```typescript
Health: { current: number; max: number }
Stats: { strength: number; defense: number; speed: number }
TurnActor: { hasActed: boolean; movementRemaining: number }
AIControlled: { pattern: 'charger'; targetEntity: number | null }
```

### Add Health + Stats + TurnActor to the Player Entity
- In `src/index.ts`, add these components to the player:
  - Health: `{ current: 20, max: 20 }`
  - Stats: `{ strength: 5, defense: 2, speed: 3 }`
  - TurnActor: `{ hasActed: false, movementRemaining: 3 }`

### `src/ecs/systems/turn.ts` — Turn System
Manages the turn loop described in `docs/combat.md`:

1. **Start of player turn:** reset player's TurnActor (hasActed=false, movementRemaining=speed)
2. **During player turn:** each movement costs 1 movementRemaining. Player can move up to
   speed tiles per turn. Primary action sets hasActed=true and ends the turn.
3. **After player turn ends:** iterate all entities with AIControlled + TurnActor.
   Reset their TurnActor, let the AISystem process each one.
4. **After all AI turns:** start new player turn (back to step 1).

### Update Movement System
- Movement now checks `turnActor.movementRemaining > 0` before allowing movement
- Each successful move decrements `movementRemaining` by 1
- If movementRemaining is 0, movement input is ignored

### Update Game Loop
The game loop now uses the TurnSystem:
- Player can press arrow keys multiple times (up to speed) per turn
- Player presses `.` (period) to pass / end turn without a primary action
- After turn ends, all AI entities take their turns (Phase 0b.2 will implement AI)
- Then a new player turn begins

### Display Speed Info
Show remaining movement in the status line: "Moves: 2/3 | '.' to end turn | Q to quit"

## Tests (`src/ecs/systems/__tests__/turn.test.ts`)
- Player with speed 3 can move 3 times, 4th move is blocked
- Ending turn resets movement for next turn
- Pass (`.`) ends the turn
- TurnActor.hasActed prevents further primary actions

## Definition of Done
- Player has limited movement per turn based on speed stat
- `.` key ends the turn (passes)
- Movement counter shows in status line
- Turn system cycles: player → (AI placeholder) → player
- `bun test` passes all turn tests
