{
  "id": "824f5ccd",
  "title": "Enhanced debug panel — show awareness details and threat source",
  "tags": [
    "quality-of-life",
    "debug",
    "ui",
    "awareness"
  ],
  "status": "done",
  "created_at": "2026-02-15T06:32:54.617Z"
}

## Goal
When debugging awareness/stuck issues in-game, the debug panel should show exactly
WHY the player is alert and which enemies are sensing them. Currently the AI line
shows `[idle]`/`[alert]` per enemy but doesn't show who's targeting the player or
the enemy's vision range vs actual distance.

## Current Debug Panel (`src/renderer/panels/debug-panel.ts`)
AI line shows: `g#5 8/8hp [alert] d=7`
- Has awareness state and distance, but missing:
  - Enemy vision range (can it actually see the player at that distance?)
  - Whether enemy has LOS to player
  - Whether THIS enemy is the reason the player is alert
  - `turnsWithoutTarget` / `alertDuration` (how close to decaying?)

## Requirements

### 1. Expanded AI Entity Info
Change the AI debug line to show vision range and alert decay:

```
g#5 8/8hp [alert 2/5] vis=6 d=7 LOS:N    ← can't see player (d=7 > vis=6)
g#8 6/8hp [alert 0/3] vis=6 d=4 LOS:Y ⚠  ← actively sensing player
g#12 8/8hp [idle] vis=6 d=15               ← far away, idle
```

Format: `[state turnsWithout/duration] vis=range d=dist LOS:Y/N`
Add `⚠` marker on enemies that are actively sensing the player (the threat source).

### 2. Player Alert Source Line
Add a dedicated line showing why the player is alert:

```
Alert: g#8 sensing you (d=4, vis=6, LOS)
```

Or when idle:
```
Status: idle (no threats sensing you)
```

This goes right after the entity count line, before AI details.

### 3. Multi-line AI Display
With more info per enemy, each AI entity should get its own line instead of
cramming all into one. The debug panel has enough vertical space since it
replaces the message log.

## Files to Change
- `src/renderer/panels/debug-panel.ts` — expand AI display, add alert source line

## Data Access
All needed data is already on components:
- `Awareness.turnsWithoutTarget`, `Awareness.alertDuration`, `Awareness.state`
- `Senses.vision.range`
- `hasLineOfSight()` from sensory.ts (import needed)
- Player Position for distance calc (already done)

## Definition of Done
- Each AI entity on its own line with vision range, distance, LOS status, decay progress
- Threat source marked with ⚠
- Player alert reason shown explicitly
- `bun test` passes
