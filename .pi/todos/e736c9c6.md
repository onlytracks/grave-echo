{
  "id": "e736c9c6",
  "title": "Phase 0a.1: ECS Core",
  "tags": [
    "phase-0a",
    "ecs",
    "foundation"
  ],
  "status": "pending",
  "created_at": "2026-02-14T22:58:04.932Z"
}

## Goal
Build the custom ECS (Entity Component System) core in `src/ecs/`.

## Read First
- `AGENTS.md` — project constraints and conventions
- `docs/technical.md` — ECS architecture, component list, system list, project structure

## Requirements

### `src/ecs/world.ts` — ECS World
- Entity creation: returns a unique numeric ID
- Entity destruction: removes entity and all its components
- Component storage: attach/detach/get components on entities
- Querying: get all entities that have a specific set of components
- Simple Map-based storage is fine (Map<entityId, Map<componentType, componentData>>)
  or similar. Optimize later if needed.

### `src/ecs/components.ts` — Component Definitions
Only define what Phase 0a needs (we add more later):
- `Position` — `{ x: number, y: number }`
- `Renderable` — `{ char: string, fg: string, bg: string }`
- `PlayerControlled` — tag component (empty object or boolean flag)
- `Collidable` — `{ blocksMovement: boolean }`

Components are plain TypeScript types/interfaces. No classes, no inheritance.

### Design Constraints
- Entities are numeric IDs, nothing more
- Components are plain objects — composition only, no inheritance
- The World class should support generic typing so `world.getComponent<Position>(entity, 'Position')` returns the correct type
- No `any` types
- Keep it minimal — under 200 lines total. This will be extended later.

## Tests (`src/ecs/__tests__/world.test.ts`)
Use `bun test`. Test:
- Create entity, get unique ID
- Add component to entity, retrieve it
- Remove component from entity
- Destroy entity removes all components
- Query entities by single component
- Query entities by multiple components (e.g., all entities with Position AND Renderable)
- Query excludes entities missing required components

## Definition of Done
- `bun test` passes all ECS tests
- World supports create, destroy, add/get/remove component, and multi-component queries
- No external dependencies
