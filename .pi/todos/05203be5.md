{
  "id": "05203be5",
  "title": "Pickup all items at position with single 'e' press",
  "tags": [
    "gameplay",
    "quality-of-life",
    "input"
  ],
  "status": "done",
  "created_at": "2026-02-16T00:40:43.243Z"
}

## Goal
Pressing `e` picks up all items at the player's position, not just the first one.
Currently requires pressing `e` once per item. Player can drop unwanted items
from the inventory screen.

## Current Behavior
`handlePlayerInput()` in `src/ecs/systems/input.ts` uses `items.find()` to get
the first item at the position and calls `pickup()` once.

## New Behavior
- `e` picks up every item at the player's tile in one action
- Each item emits its own pickup message ("You pick up X")
- Auto-equip still fires per item (empty slot gets filled)
- If an item can't be picked up due to weight, message "Too heavy to pick up X"
  and continue to next item — grab what you can
- "Nothing to pick up here." only if zero items at position

## Implementation
In `handlePlayerInput()` (src/ecs/systems/input.ts):

```typescript
if (event.type === "pickup" && messages) {
  const pos = world.getComponent(player, "Position")!;
  const items = world.query("Position", "Item");
  const itemsHere = items.filter((id) => {
    const p = world.getComponent(id, "Position")!;
    return p.x === pos.x && p.y === pos.y;
  });
  if (itemsHere.length === 0) {
    messages.add("Nothing to pick up here.");
    return false;
  }
  let any = false;
  for (const itemId of itemsHere) {
    const result = pickup(world, player, itemId, messages);
    if (result) any = true;
  }
  return any;
}
```

Note: `pickup()` already handles the weight check and emits "Inventory too heavy"
message, so no changes needed there.

## Files to Change
- `src/ecs/systems/input.ts` — change `find` to `filter`, loop `pickup()` calls

## Tests
- Unit: 3 items at position, single pickup call grabs all 3
- Unit: 2 items fit, 1 too heavy — picks up 2, messages about the 3rd
- Unit: 0 items at position — "Nothing to pick up here."
- `bun test` passes

## Definition of Done
- Single `e` press picks up all items at player position
- Weight limit still respected per item
- Auto-equip still works
- `bun test` passes
